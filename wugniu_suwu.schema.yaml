# Rime schema
# encoding: utf-8

schema:
  schema_id: wugniu_suwu
  name: 吳越語
  version: "2025.08.15"
  author:
    - 予安 <181065229@qq.com> (dict)
    - 雪心居士 <sihsin@live.com> (schema)
    - Shin Zoqchiuq <shinzoqchiuq@outlook.com> (schema)
    - 雪螢SiqYin <siqyin@qq.com> (dict & schema)
  description: |
    基於蘇州吳語注音輸入方案吳語學堂版
    https://www.wugniu.com/
    https://github.com/NGLI/rime-wugniu_soutseu/
  dependencies:
    - luna_pinyin
    - stroke

switches:
  - name: ascii_mode
    reset: 0
    states: [漢字, 羅馬字]
  - name: full_shape
    states: [半角, 全角]
  - name: ascii_punct
    states: [句讀, 符號]
  - options: [ noop, varients_wy, variants_hk, trad_tw, simplification]
    states: [ 漢字, 吳越傳統漢字, 香港繁體漢字, 臺灣繁體漢字, 大陆简化汉字]
    reset: 4

engine:
  processors:
    - ascii_composer
    - recognizer
    - key_binder
    - speller
    - punctuator
    - selector
    - navigator
    - express_editor
  segmentors:
    - ascii_segmentor
    - matcher
    - affix_segmentor@luna_pinyin # 自定義tag luna_pinyin
    - affix_segmentor@stroke      # 自定義tag stroke
    - abc_segmentor
    - punct_segmentor
    - fallback_segmentor
  translators:
    - punct_translator
    - script_translator              # 主翻譯器
    - reverse_lookup_translator
    - script_translator@luna_pinyin  # 用於反查的luna_pinyin翻譯器
    - table_translator@stroke        # 用於反查个stroke翻譯器
    - table_translator@custom_phrase # 用戶短語
  filters:
    - simplifier@varients_wy
    - simplifier@variants_hk
    - simplifier@trad_tw
    - simplifier
    - uniquifier
    - reverse_lookup_filter@wy_reverse_lookup # 反查濾鏡

speller:
  alphabet: abcdefghijklmnopqrstuvwxyz
  delimiter: " '"
  algebra:
    - xform/^([bcdfghjklpqstvwxyz])$/$1_/
    - xform/\d//     # 聲調去脱

    # 兼容吳語協會式拼音
    - derive/q/h/
    - derive/gni(?=[nqh]|\d|\b)/nyi/
    - derive/gni(?=[aoue])/ny/
    - derive/er/r/

    # 尖團弗分
    - derive/ts(h?)i/c$1i/
    - derive/^(s|z)i/$1hi/
    # 干官弗分
    - derive/uoe/oe/
    - derive/woe/ghoe/
    # 求拳弗分
    - derive/(?<=[yi])eu/oe/
    # 打黨弗分
    - derive/aon/an/
    - derive/an/aon/
    # 走酒弗分
    - derive/ieu/eu/
    # 李旅弗分
    - derive/(?<=[szhl])iu/i/
    # 麻摩弗分
    - derive/mu/mo/
    # 郭囻弗分
    - derive/ueq/oq/
    # u韻變躰
    - derive/u/ou/
    # wu音變躰
    - derive/wu/ghou/
    # 襪麥弗分
    - derive/ae(?=q|h)/a/
    # 司書弗分
    - derive/(?<=[szh])yu/y/

    # 簡拼
    - abbrev/^([a-z]).+$/$1/
    - abbrev/^([pmtnlszckg]h|gn|ng|tsh?|dz).+$/$1/
    # 容差 au => ao
    - derive/au/ao/
    # c組聲母後自動加i
    - derive/^(c|j|gn|[csz]h)i(?=[aoue])/$1/
    # 容差 介音、主元音順序相調
    - derive/^(.+)([iu])([aeou])([euonqh])$/$1$3$2$4/
    # 容差 oe => eo
    - derive/oe/eo/
    # 容差 ao => oa
    - derive/ao/oa/

# 主翻譯器 吳拼
translator:
  dictionary: wugniu_suwu # 調取詞典wugniu_suwu
  prism: wugniu_suwu      # 根據拼寫運算生成棱鏡文件wugniu_suwu
  spelling_hints: 1          # 標註拼音
  comment_format:
    # 単字調弗顯示
    - xform/\d//

# 副翻譯器1 明月拼音
luna_pinyin:
  tag: luna_pinyin
  dictionary: luna_pinyin
  prefix: "q"
  tips: 〔華語〕
  preedit_format:
    - xform/([nl])v/$1ü/
    - xform/([nl])ue/$1üe/
    - xform/([jqxy])v/$1u/

# 副翻譯器2 筆畵
stroke:
  tag: stroke
  dictionary: stroke
  prefix: "x"
  tips: 〔筆畵〕
  preedit_format:
    - xlit/hspnz/一丨丿丶乙/
    
# 副翻譯器3 用戸短語
custom_phrase:
  dictionary: ""
  user_dict: custom_phrase # 用戸詞典名
  db_class: stabledb       # 詞典類型為僅讀格式
  enable_completion: false
  enable_sentence: false
  initial_quality: 1

# 反查濾鏡
wy_reverse_lookup:
  tags: [luna_pinyin, stroke] # 掛在上翻譯器luna_pinyin和stroke上
  overwrite_comment: true     # 覆蓋其他提示
  dictionary: wugniu_suwu  # 反查所得為蘇滬吳拼
  comment_format:
    __include: translator/comment_format 
    
varients_wy:
  option_name: varients_wy
  opencc_config: t2wy.json
  
variants_hk:
  option_name: variants_hk
  opencc_config: t2hkf.json

trad_tw:
  option_name: trad_tw
  opencc_config: t2tw.json
  
punctuator:
  import_preset: symbols_wu # 句讀處理器，統一從外部導入

key_binder:
  import_preset: default # 快捷鍵，統一從外部導入

recognizer:
  import_preset: default # 特殊規則輸入碼，統一從外部導入
  patterns:
    luna_pinyin: "^q[a-z']*$"
    stroke: "^x[hspnz]*$"
